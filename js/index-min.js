"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,e=Array(n.length);t<n.length;t++)e[t]=n[t];return e}return Array.from(n)}!function(){var n="xianzhe",t="me";new Vue({el:"#mobile",data:{messages:[],dialogs:null,lastDialog:null,msgChain:Promise.resolve(),isXianzheTyping:!1,nextTopics:[],hasPrompt:!1,latestMsgContent:null},mounted:function(){var n=this;$.getJSON("./assets/dialog.json",function(t){n.dialogs=t,n.nextTopics=n.dialogs.fromUser,n.appendDialog("0000")})},methods:{appendDialog:function(t){var i=this;if("object"===(void 0===t?"undefined":_typeof(t))&&t.length>0)t.forEach(function(n){return i.appendDialog(n)});else{if(null!=t){this.isXianzheTyping=!0;var o=this.getDialog(t);return e(o.details).forEach(function(t){i.msgChain=i.msgChain.then(function(){return s(700)}).then(function(){return i.sendMsg(t,n)})}),o.nextXianzhe?this.appendDialog(o.nextXianzhe):this.msgChain.then(function(){i.lastDialog=o,i.isXianzheTyping=!1})}this.lastDialog.responses=null}},sendMsg:function(n,t){switch(t){case"me":return this.sendUserMsg(n);default:return this.sendFriendMsg(n,t)}},sendFriendMsg:function(n,t){var r=this,a=e(n),u=a.replace(/<[^>]+>/g,"").length,l=/<img[^>]+>/.test(a),h=u>5||l,c={author:t,content:h?'\n        <div class="dot"></div>\n        <div class="dot"></div>\n        <div class="dot"></div>\n    ':a,isImg:l};return this.messages.push(c),h?(this.markMsgSize(c),setTimeout(o),s(Math.min(100*u,2e3)).then(function(){return r.markMsgSize(c,a)}).then(function(){return s(150)}).then(function(){c.content=a,i()})):(i(),Promise.resolve())},sendUserMsg:function(n){return this.messages.push({author:t,content:n}),i(),Promise.resolve()},markMsgSize:function(n){var t=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.latestMsgContent=e||n.content,s(0).then(function(){return n.isImg&&r($("#mock-msg img"))}).then(function(){var e;Object.assign(n,{width:(e=$("#mock-msg")).width(),height:e.height()}),t.messages=[].concat(_toConsumableArray(t.messages))})},getDialog:function(n){var t=this.dialogs.fromXianzhe.filter(function(t){return t.id===n});return t?t[0]:null},getDialogFromUser:function(n){var t=this.dialogs.fromUser.filter(function(t){return t.id===n});return t?t[0]:null},togglePrompt:function(n){this.isXianzheTyping||(this.hasPrompt=n)},respond:function(n){return _gaq&&_gaq.push(["_trackEvent","Home","respond",n.content]),this.say(n.content,n.nextXianzhe)},ask:function(n){_gaq&&_gaq.push(["_trackEvent","Home","ask",n.brief]);var t=e(n.details);return this.say(t,n.nextXianzhe)},say:function(n,e){var i=this;return this.hasPrompt=!1,s(200).then(function(){return i.sendMsg(n,t)}).then(function(){return s(300)}).then(function(){return i.appendDialog(e)})}}});function e(n){return"string"!=typeof n&&n.length?n[Math.floor(Math.random()*n.length)]:n}function i(){setTimeout(function(){o();var n=$("#mobile-body-content .msg-row:last-child .msg");n.find("a").attr("target","_blank"),r(n).then(o)})}function o(){var n=$("#mobile-body-content"),t=n[0].scrollHeight-n.height()-n.scrollTop(),e=Date.now();requestAnimationFrame(function i(){var o=Math.min(1,(Date.now()-e)/250);n.scrollTop(n.scrollTop()+t*o),o<1&&requestAnimationFrame(i)})}function s(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){setTimeout(t,n)})}function r(n){return new Promise(function(t){n.one("load",t).each(function(n,t){t.complete&&$(t).trigger("load")})})}}();